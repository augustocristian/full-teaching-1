version: '3'

services:

  full-teaching-mysql-${tjobname}:
    image: mysql:5.7.22
    environment:
      - MYSQL_ROOT_PASSWORD=pass
      - MYSQL_DATABASE=full_teaching

  full-teaching-${tjobname}-openvidu-server-kms:
    image: ${dockerImageResource}
    ports:
      - ${openviduport}:80
    environment:
      - openvidu.secret=MY_SECRET
      - openvidu.publicurl=docker

  full-teaching-${tjobname}:
    image: codeurjc/full-teaching:2.3.0
    depends_on:
      - full-teaching-mysql-${tjobname}
      - full-teaching-${tjobname}-openvidu-server-kms
    ports:
      - ${mainport}:5001
    environment:
      - WAIT_HOSTS=full-teaching-mysql-${tjobname}:3306
      - WAIT_HOSTS_TIMEOUT=60
      - MYSQL_PORT_3306_TCP_ADDR=full-teaching-mysql-${tjobname}
      - MYSQL_PORT_3306_TCP_PORT=3306
      - MYSQL_ENV_MYSQL_DATABASE=full_teaching
      - MYSQL_ENV_MYSQL_USER=root
      - MYSQL_ENV_MYSQL_PASSWORD=pass
      - server.port=5001
      - openvidu.url=https://full-teaching-${tjobname}-openvidu-server-kms:${openviduport}
      - openvidu.secret=MY_SECRET
networks:
  fullteaching-${tjobname}:
    driver: bridge